<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="../styles/bootstrap.css">
    <link rel="stylesheet" href="../styles/bootstrap-override.css">
    <link rel="stylesheet" href="../styles/styles.css">
    <title>–£–¥–∏–≤–∏ –º–µ–Ω—è ‚Äî –°–±–æ—Ä–Ω–∏–∫ —Å—Ç–∏—Ö–æ–≤</title>
    <script src="../scripts/theme.js"></script>
    <script src="../scripts/bootstrap.bundle.js"></script>
    <script src="../scripts/jquery-3.7.1.min.js"></script>
    <script src="../scripts/load-components.js"></script>
</head>
<body>
    <!-- Page Loader -->
    <div id="page-loader">
        <div class="loader-spinner"></div>
    </div>

    <div id="header-placeholder"></div>

    <main>
        <section class="surprise-section py-5">
            <div class="container">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div class="row justify-content-center mb-5">
                    <div class="col-lg-8 text-center">
                        <h2 class="display-4 fw-bold mb-3">üé≠ –£–¥–∏–≤–∏ –º–µ–Ω—è</h2>
                        <p class="lead text-secondary mb-4">–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –ø–æ—ç–∑–∏–∏ –∏ –≤–µ–ª–∏–∫–∏—Ö —Ä—É—Å—Å–∫–∏—Ö –ø–æ—ç—Ç–∞—Ö</p>
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                        <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
                            <button id="showRandomFact" class="btn btn-main">
                                üé≤ –°–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–∫—Ç
                            </button>
                            <button id="showAllFacts" class="btn btn-outline-secondary">
                                üìö –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                            </button>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                    üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                                </button>
                                <ul class="dropdown-menu" id="categoryFilter">
                                    <li><a class="dropdown-item" href="#" data-category="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" data-category="history">üìú –ò—Å—Ç–æ—Ä–∏—è</a></li>
                                    <li><a class="dropdown-item" href="#" data-category="biography">üë§ –ë–∏–æ–≥—Ä–∞—Ñ–∏—è</a></li>
                                    <li><a class="dropdown-item" href="#" data-category="creative">‚úçÔ∏è –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</a></li>
                                    <li><a class="dropdown-item" href="#" data-category="talent">üé® –¢–∞–ª–∞–Ω—Ç—ã</a></li>
                                    <li><a class="dropdown-item" href="#" data-category="influence">üåü –í–ª–∏—è–Ω–∏–µ</a></li>
                                    <li><a class="dropdown-item" href="#" data-category="record">üèÜ –†–µ–∫–æ—Ä–¥—ã</a></li>
                                </ul>
                            </div>
                        </div>

                        <!-- –°—á–µ—Ç—á–∏–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                        <div class="text-muted small">
                            <span id="factCounter">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                    </div>
                </div>

                <!-- –°–µ—Ç–∫–∞ —Å —Ñ–∞–∫—Ç–∞–º–∏ -->
                <div class="row g-4" id="factsGrid">
                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
                    <div class="col-12 text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script>
        // –ú–µ–Ω–µ–¥–∂–µ—Ä —Ñ–∞–∫—Ç–æ–≤
        class FactsManager {
            constructor() {
                this.facts = [];
                this.currentCategory = 'all';
            }

            async loadFacts() {
                try {
                    const response = await fetch('../data/facts.json');
                    const data = await response.json();
                    this.facts = data.facts;
                    console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.facts.length} —Ñ–∞–∫—Ç–æ–≤`);
                    return this.facts;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–∫—Ç–æ–≤:', error);
                    return [];
                }
            }

            getFactsByCategory(category) {
                if (category === 'all') return this.facts;
                return this.facts.filter(fact => fact.category === category);
            }

            getRandomFact() {
                const availableFacts = this.getFactsByCategory(this.currentCategory);
                if (availableFacts.length === 0) return null;
                
                const randomIndex = Math.floor(Math.random() * availableFacts.length);
                return availableFacts[randomIndex];
            }

            getRandomUniqueFacts(count = 3) {
                const availableFacts = this.getFactsByCategory(this.currentCategory);
                const shuffled = [...availableFacts].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, Math.min(count, shuffled.length));
            }
        }

        const factsManager = new FactsManager();

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ñ–∞–∫—Ç–∞
        function renderFactCard(fact) {
            const categoryNames = {
                'history': '–ò—Å—Ç–æ—Ä–∏—è',
                'biography': '–ë–∏–æ–≥—Ä–∞—Ñ–∏—è',
                'creative': '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ',
                'talent': '–¢–∞–ª–∞–Ω—Ç—ã',
                'influence': '–í–ª–∏—è–Ω–∏–µ',
                'record': '–†–µ–∫–æ—Ä–¥—ã'
            };
            const categoryEmoji = {
                'history': 'üìú',
                'biography': 'üë§',
                'creative': '‚úçÔ∏è',
                'talent': 'üé®',
                'influence': 'üåü',
                'record': 'üèÜ'
            };

            return `
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="surprise-card" data-fact-id="${fact.id}" data-category="${fact.category}">
                        <div class="card-content">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge">${categoryEmoji[fact.category] || 'üìñ'} ${categoryNames[fact.category] || fact.category}</span>
                                <span class="text-muted small">#${fact.id}</span>
                            </div>
                            <h3 class="h5 fw-bold mb-3">${fact.title}</h3>
                            <p class="mb-0">${fact.text}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ–≤
        function renderFacts(facts) {
            const grid = document.getElementById('factsGrid');
            
            if (facts.length === 0) {
                grid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <p class="text-muted fs-5">üòî –§–∞–∫—Ç–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = facts.map(fact => renderFactCard(fact)).join('');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            setTimeout(() => {
                document.querySelectorAll('.surprise-card').forEach((card, i) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'all 0.4s ease';
                    
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, i * 80);
                });
            }, 50);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
        function updateCounter() {
            const counter = document.getElementById('factCounter');
            const total = factsManager.facts.length;
            const filtered = factsManager.getFactsByCategory(factsManager.currentCategory).length;
            
            if (factsManager.currentCategory === 'all') {
                counter.textContent = `üìä –í—Å–µ–≥–æ —Ñ–∞–∫—Ç–æ–≤: ${total}`;
            } else {
                counter.textContent = `üìä –ü–æ–∫–∞–∑–∞–Ω–æ: ${filtered} –∏–∑ ${total} —Ñ–∞–∫—Ç–æ–≤`;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('showRandomFact')?.addEventListener('click', () => {
            const facts = factsManager.getRandomUniqueFacts(3);
            renderFacts(facts);
            updateCounter();
        });

        document.getElementById('showAllFacts')?.addEventListener('click', () => {
            const facts = factsManager.getFactsByCategory(factsManager.currentCategory);
            renderFacts(facts);
            updateCounter();
        });

        // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        document.getElementById('categoryFilter')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('dropdown-item')) {
                e.preventDefault();
                const category = e.target.dataset.category;
                factsManager.currentCategory = category;
                
                const facts = factsManager.getFactsByCategory(category);
                renderFacts(facts);
                updateCounter();
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            await factsManager.loadFacts();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 6 —Å–ª—É—á–∞–π–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const initialFacts = factsManager.getRandomUniqueFacts(6);
            renderFacts(initialFacts);
            updateCounter();
        }

        // –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>